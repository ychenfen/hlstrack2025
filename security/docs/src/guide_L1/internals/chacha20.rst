.. 
   .. Copyright © 2019–2023 Advanced Micro Devices, Inc

`Terms and Conditions <https://www.amd.com/en/corporate/copyright>`_.

.. meta::
   :keywords: Vitis, Security, Library, Chacha20, algorithms
   :description: Chacha20 is a cipher stream. Its input includes a 256-bit key, a 32-bit counter, a 96-bit nonce and plain text.
   :xlnxdocumentclass: Document
   :xlnxdocumenttype: Tutorials


*****************************
Chacha20 Algorithms
*****************************

.. toctree::
   :maxdepth: 1

Chacha20 is a cipher stream. Its input includes a 256-bit key, a 32-bit counter, a 96-bit nonce and plain text.
Its initial state is a 4*4 matrix of 32-bit words. The first row is a constant string "expand 32-byte k," which is cut into 4*32-bit words. The second and the third are filled with 256-bit key. The first word in the last row are 32-bit counter and the others are 96-bit nonce. 
It generates 512-bit keystream in each iteration to encrypt a 512-bit block of plain text.
When the rest of plain text is less 512 bits after several  encryptions, do padding to the left with 0s(MSB) in the last input data and remove the same bits of non-useful data from the last output data.
Its encryption and decryption are same as long as input same initial key, counter and nonce.

XChacha20 is a variant of original Chacha20 to support Longer nonce of 192bits. Its implementation is similar to Chacha20.

.. image:: /images/chacha.png
   :alt: Initial state of chacha20
   :width: 30%
   :align: center


Implementation
=======================

Chacha20 consist of two parts: initialization state and encryption as shown in the following figure:

.. image:: /images/chhacha20_detail.png
   :alt: Internal structure of chacha20
   :width: 100%
   :align: center


Initial state is generated by the input 256-bit key, 32-bit counter, and 96-bit nonce.
In the encryption, a new 512-bit key is generated and is used for doing XOR with 512-bit plain text, then output a cipher block in each iteration.


Performance (Device: U250)
=================================

==== ====== ======== ======== ===== ====== ===== ====== ========
 II   CLB     LUT       FF     DSP   BRAM   SRL   URAM   CP(ns)
==== ====== ======== ======== ===== ====== ===== ====== ========
 1    3029   20535     21112    0      0    64     0     2.989
==== ====== ======== ======== ===== ====== ===== ====== ========
